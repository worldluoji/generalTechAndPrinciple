1. 第二层，数据链路层，也即 MAC 层。
MAC 的全称是 Medium Access Control，即媒体访问控制。
控制什么呢？其实就是控制在往媒体上发数据的时候，谁先发、谁后发的问题。防止发生混乱。
这个问题中的规则，学名叫多路访问。有很多算法可以解决这个问题。就像车管所管束马路上跑的车，能想的办法都想过了。
比如接下来这三种方式：
方式一：分多个车道。每个车一个车道，你走你的，我走我的。这在计算机网络里叫作信道划分；
方式二：今天单号出行，明天双号出行，轮着来。这在计算机网络里叫作轮流协议；
方式三：不管三七二十一，有事儿先出门，发现特堵，就回去。错过高峰再出。我们叫作随机接入协议。著名的以太网，用的就是这个方式。

2. MAC地址  9A-5F-D3-49-15-D8 一般是用6个字节存储即可，即48bit。

3. CRC(循环冗余检测)使用的算法是XOR异或算法。这个CRC(循环冗余检测)解决的是：在网络上传输数据出错的问题。
数据链路层不仅得加头部还得加尾部。加头部加的是源MAC地址和目标MAC地址，是为了解决这个网络包发给谁的问题。 
加尾部加的是CRC(循环冗余检测)，是为了解决这个网络包在网络上传输数据出错的问题。

4. 一个广播的网络里面接入了 N 台机器，我怎么知道每个 MAC 地址是谁呢？
这就是 ARP 协议，也就是已知 IP 地址，求 MAC 地址的协议。
为了避免每次都用 ARP 请求，机器本地也会进行 ARP 缓存。
当然机器会不断地上线下线，IP 也可能会变，所以 ARP 的 MAC 地址缓存过一段时间就会过期。

5. 如何知道目标 MAC 地址是否就是连接某个口的电脑的 MAC 地址呢？
这就需要一个能把 MAC 头拿下来，检查一下目标 MAC 地址，然后根据策略转发的设备
，这个设备显然是个二层设备，我们称为交换机。 

一台 MAC1 电脑将一个包发送给另一台 MAC2 电脑，当这个包到达交换机的时候，
一开始交换机也不知道 MAC2 的电脑在哪个口，它只能将包转发给除了来的那个口之外的其他所有的口。
这个时候交换机会干一件非常聪明的事情，就是交换机会记住，MAC1 是来自一个明确的口。
以后有包的目的地址是 MAC1 的，直接发送到这个口就可以了。

当交换机作为一个关卡一样，过了一段时间之后，就有了整个网络的一个结构了，这个时候，基本上不用广播了，
全部可以准确转发。
当然，每个机器的 IP 地址会变，所在的口也会变，因而交换机上的学习的结果，我们称为转发表，是有一个过期时间的。

6. RARP用来主动通过Mac获取IP地址，不过现在都用DHCP动态获取IP地址了。

7. 如果我们买的交换机是支持 VLAN 的，当这个交换机把二层的头取下来的时候，就能够识别 VLAN ID。
这样只有相同 VLAN 的包，才会互相转发，不同 VLAN 的包，是看不到的。这样广播问题和安全问题就都能够解决了。
广播问题（见图）：
机器 1 访问机器 2 的过程。一开始，机器 1 并不知道机器 2 的 MAC 地址，所以它需要发起一个 ARP 的广播，
这样其实交换机A的左端也会收到ARP广播报文，由于交换机 A 这个时候还是不知道机器 2 在哪个局域网，
于是将广播包又转发到局域网二，又继续广播，最终形成一个环路。
解决广播问题还可以物理隔离:
每个部门设一个单独的会议室，对应到网络方面，就是每个部门有单独的交换机，配置单独的子网，
这样部门之间的沟通就需要路由器了。这样的问题在于，有的部门人多，有的部门人少。
人少的部门慢慢人会变多，人多的部门也可能人越变越少。如果每个部门有单独的交换机，口多了浪费，少了又不够用。

8. MTU 大小是不包含二层头部和尾部的，MTU 1500表示二层MAC帧大小不超过1518. MAC 头14 字节，尾4字节。
如果放不下，就需要分片了。

9. STP
在数据结构中，有一个方法叫做最小生成树。有环的我们常称为图。将图中的环破了，就生成了树。
在计算机网络中，生成树的算法叫作 STP，全称 Spanning Tree Protocol。使用STP可以很好的解决环路问题。
在STP里只有一条路径起作用。
a. STP中重要的几个概念：
1) Root Bridge，也就是根交换机。这个比较容易理解，可以比喻为“掌门”交换机，是某棵树的老大，是掌门，最大的大哥。
2) Designated Bridges，有的翻译为指定交换机。这个比较难理解，可以想像成一个“小弟”，对于树来说，
就是一棵树的树枝。所谓“指定”的意思是“拜谁做大哥”，即其他交换机通过这个交换机到达根交换机，也就相当于拜他做了大哥。
这里注意是树枝，不是叶子，因为叶子往往是主机。
3) Bridge Protocol Data Units （BPDU） ，网桥协议数据单元。可以比喻为“相互比较实力”的协议。
行走江湖，比的就是武功，拼的就是实力。当两个交换机碰见的时候，也就是相连的时候，就需要互相比一比内力了。
BPDU 只有掌门能发，已经隶属于某个掌门的交换机只能传达掌门的指示。
4) Priority Vector，优先级向量。可以比喻为实力 （值越小越牛）。实力是啥？就是一组 ID 数目，
[Root Bridge ID, Root Path Cost, Bridge ID, and Port ID]。为什么这样设计呢？这是因为要看怎么来比实力。
先看 Root Bridge ID。拿出老大的 ID 看看，发现掌门一样，那就是师兄弟；再比 Root Path Cost，
也即我距离我的老大的距离，也就是拿和掌门关系比，看同一个门派内谁和老大关系铁；
最后比 Bridge ID，比我自己的 ID，拿自己的本事比。

b. STP工作过程
1）一开始，所有的交换机都认为自己是掌门，每个网桥都被分配了一个 ID。
这个 ID 里有管理员分配的优先级，当然网络管理员知道哪些交换机贵，哪些交换机好，就会给它们分配高的优先级。
这种交换机生下来武功就很高，起步就是乔峰。
2）既然都是掌门，互相都连着网线，就互相发送 BPDU 来比功夫呗。
这一比就发现，有人是岳不群，有人是封不平，赢的接着当掌门，输的就只好做小弟了。
当掌门的还会继续发 BPDU，而输的人就没有机会了。
它们只有在收到掌门发的 BPDU 的时候，转发一下，表示服从命令。
3) 数字表示优先级。查看“STP.jpg”这个图
(Wikipedia 说连线上的数字跟两个交换机之间的带宽有关，带宽越大，数字越小。更准确地说是倒数关系。)，
5 和 6 碰见了，6 的优先级低，所以乖乖做小弟。于是一个小门派形成，5 是掌门，6 是小弟。
其他诸如 1-7、2-8、3-4 这样的小门派，也诞生了。于是江湖出现了很多小的门派，小的门派，接着合并。
4) 门派合并会存在几种情形
Ⅰ. 掌门遇到掌门：比如1和5遇到了，1和5PK，１胜出，5就乖乖当小弟了，５的门派就归到了１中。
Ⅱ. 同门相遇
同门相遇可以是掌门与自己的小弟相遇，这说明存在“环”了。这个小弟已经通过其他门路拜在你门下，结果你还不认识，
就 PK 了一把。结果掌门发现这个小弟功夫不错，不应该级别这么低，就把它招到门下亲自带，那这个小弟就相当于升职了。
比如 1 和 6 相遇。6 原来就拜在 1 的门下，只不过 6 的上司是 5，5 的上司是 1。1 发现，6 距离我才只有 2，
比从 5 这里过来的 5（=4+1）近多了，那 6 就直接汇报给我吧。于是，5 和 6 分别汇报给 1。
同门相遇还可以是小弟相遇。这个时候就要比较谁和掌门的关系近，当然近的当大哥。
Ⅲ. 掌门遇到其它帮派小弟: 小弟拿自己的掌门与该掌门比。赢了,则该掌门被合并到小的掌门门派下;
输了,小弟拜入新掌门。
Ⅳ. 不同们小弟相遇:谁输入就拜入对方门下.
